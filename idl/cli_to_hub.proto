syntax = "proto3";

package idl;

service CliToHub {
    rpc Ping(PingRequest) returns (PingReply) {}
    rpc StatusUpgrade(StatusUpgradeRequest) returns (StatusUpgradeReply) {}
    rpc StatusConversion(StatusConversionRequest) returns (StatusConversionReply) {}
    rpc CheckConfig(CheckConfigRequest) returns (CheckConfigReply) {}
    rpc CheckSeginstall(CheckSeginstallRequest) returns (CheckSeginstallReply) {}
    rpc CheckObjectCount(CheckObjectCountRequest) returns (CheckObjectCountReply) {}
    rpc CheckVersion(CheckVersionRequest) returns (CheckVersionReply) {}
    rpc CheckDiskSpace(CheckDiskSpaceRequest) returns (CheckDiskSpaceReply) {}
    rpc PrepareInitCluster(PrepareInitClusterRequest) returns (PrepareInitClusterReply) {}
    rpc PrepareShutdownClusters(PrepareShutdownClustersRequest) returns (PrepareShutdownClustersReply) {}
    rpc UpgradeConvertMaster(UpgradeConvertMasterRequest) returns (UpgradeConvertMasterReply) {}
    rpc PrepareStartAgents(PrepareStartAgentsRequest) returns (PrepareStartAgentsReply) {}
    rpc UpgradeShareOids(UpgradeShareOidsRequest) returns (UpgradeShareOidsReply) {}
    rpc UpgradeValidateStartCluster(UpgradeValidateStartClusterRequest) returns (UpgradeValidateStartClusterReply) {}
    rpc UpgradeConvertPrimaries(UpgradeConvertPrimariesRequest) returns (UpgradeConvertPrimariesReply) {}
    rpc UpgradeReconfigurePorts(UpgradeReconfigurePortsRequest) returns (UpgradeReconfigurePortsReply) {}
    rpc ConfigSet(ConfigSetRequest) returns (ConfigSetReply) {}
    rpc GetConfig(GetConfigRequest) returns (GetConfigReply) {}
}

message UpgradeReconfigurePortsRequest {}
message UpgradeReconfigurePortsReply {}

message UpgradeConvertPrimariesRequest {
    string OldBinDir = 1;
    string NewBinDir = 2;
}
message UpgradeConvertPrimariesReply {}

message UpgradeShareOidsRequest {}
message UpgradeShareOidsReply {}

message UpgradeValidateStartClusterRequest {}
message UpgradeValidateStartClusterReply {}

message PingRequest {}
message PingReply {}

message StatusConversionRequest {}

message StatusConversionReply {
    repeated string conversionStatuses = 1;
}

message StatusUpgradeRequest {}

message StatusUpgradeReply {
    repeated UpgradeStepStatus listOfUpgradeStepStatuses = 1;
}

message UpgradeStepStatus {
    UpgradeSteps step = 1;
    StepStatus status = 2;
}

enum UpgradeSteps {
    UNKNOWN_STEP = 0; // http://androiddevblog.com/protocol-buffers-pitfall-adding-enum-values/
    CONFIG = 1;
    SEGINSTALL = 2;
    INIT_CLUSTER = 3;
    SHUTDOWN_CLUSTERS = 4;
    CONVERT_MASTER = 5;
    START_AGENTS = 6;
    SHARE_OIDS = 7;
    CONVERT_PRIMARIES = 8;
    VALIDATE_START_CLUSTER = 9;
    RECONFIGURE_PORTS = 10;
}

enum StepStatus {
    UNKNOWN_STATUS = 0; // http://androiddevblog.com/protocol-buffers-pitfall-adding-enum-values/
    PENDING = 1;
    RUNNING = 2;
    COMPLETE = 3;
    FAILED = 4;
}

message CheckConfigRequest {
    int32 dbPort = 1;
    string oldBinDir = 2;
}

// Consider removing the status as errors are/should be put on the error field.
message CheckConfigReply {
    string ConfigStatus  = 1;
}

message CheckSeginstallRequest {}
message CheckSeginstallReply {}

message PrepareStartAgentsRequest {}
message PrepareStartAgentsReply {}

message CountPerDb {
    string DbName = 1;
    int32 AoCount = 2;
    int32 HeapCount = 3;
}
message CheckObjectCountRequest {
    int32 DbPort = 1;
}

message CheckObjectCountReply {
    repeated CountPerDb ListOfCounts = 1;
}

message CheckVersionRequest {
    int32 DbPort = 1;
    string Host = 2;
}

message CheckVersionReply {
    bool IsVersionCompatible = 1;
}

message CheckDiskSpaceRequest {}

message CheckDiskSpaceReply {
    repeated string SegmentFileSysUsage = 1;
}

message PrepareShutdownClustersRequest {
    string OldBinDir = 1;
    string NewBinDir = 2;
}
message PrepareShutdownClustersReply {}

message PrepareInitClusterRequest {
    int32 DbPort = 1;
    string NewBinDir = 2;
}
message PrepareInitClusterReply {}

message UpgradeConvertMasterRequest {
    string OldBinDir = 1;
    string OldDataDir = 2;
    string NewBinDir = 3;
    string NewDataDir = 4;
}

message UpgradeConvertMasterReply {}

message ConfigSetRequest {
		string flagName = 1;
		string flagVal = 2;
}
message ConfigSetReply {}

message GetConfigRequest {
	string name = 1;
}
message GetConfigReply {
	string value = 1;
}
